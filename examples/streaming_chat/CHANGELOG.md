# ğŸ“ å˜æ›´æ—¥å¿— - Redis Pub/Sub é‡æ„

## ğŸš€ ç‰ˆæœ¬ 2.0.0 - Redis Pub/Sub æ¨¡å¼

### ğŸ¯ æ ¸å¿ƒæ”¹è¿›

#### ğŸ”„ æ¶æ„é‡æ„
- **åŸæ¶æ„**ï¼šä½¿ç”¨æœ¬åœ° `asyncio.Queue` è¿›è¡Œæ¶ˆæ¯ä¼ é€’
- **æ–°æ¶æ„**ï¼šä½¿ç”¨ **Redis Pub/Sub** è¿›è¡Œåˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’

#### ğŸ—ï¸ è§£å†³çš„é—®é¢˜
1. **å¤šå‰¯æœ¬æ•°æ®ä¸€è‡´æ€§**ï¼šå¤šä¸ªæœåŠ¡å®ä¾‹å¯ä»¥å…±äº«æ¶ˆæ¯çŠ¶æ€
2. **æ°´å¹³æ‰©å±•**ï¼šæ”¯æŒæ— çŠ¶æ€éƒ¨ç½²ï¼Œä»»æ„å®ä¾‹éƒ½èƒ½å¤„ç†æ¶ˆæ¯
3. **æ•…éšœæ¢å¤**ï¼šRedisæä¾›æŒä¹…åŒ–ï¼Œæ¶ˆæ¯ä¸ä¼šä¸¢å¤±
4. **è´Ÿè½½å‡è¡¡**ï¼šæ”¯æŒNginxè´Ÿè½½å‡è¡¡å™¨

### ğŸ“¦ æ–°å¢æ–‡ä»¶

#### ğŸ”§ é…ç½®æ–‡ä»¶
- `requirements.txt` - Pythonä¾èµ–ç®¡ç†
- `docker-compose.yml` - å¤šå‰¯æœ¬éƒ¨ç½²é…ç½®
- `nginx.conf` - Nginxè´Ÿè½½å‡è¡¡é…ç½®
- `Dockerfile` - å®¹å™¨åŒ–éƒ¨ç½²é…ç½®

#### ğŸ§ª æµ‹è¯•æ–‡ä»¶
- `test_redis_pubsub.py` - Redis Pub/SubåŠŸèƒ½æµ‹è¯•
- `start.sh` - è‡ªåŠ¨åŒ–å¯åŠ¨è„šæœ¬

#### ğŸ“š æ–‡æ¡£æ–‡ä»¶
- `README.md` - è¯¦ç»†ä½¿ç”¨è¯´æ˜
- `CHANGELOG.md` - å˜æ›´æ—¥å¿—

### ğŸ”„ ä»£ç å˜æ›´

#### ğŸ“ ä¸»è¦ä¿®æ”¹
1. **Redisé›†æˆ**ï¼š
   ```python
   # æ–°å¢Redisè¿æ¥
   import redis.asyncio as redis
   REDIS_URL = os.getenv("REDIS_URL", "redis://localhost:6379")
   redis_client = redis.from_url(REDIS_URL, decode_responses=True)
   ```

2. **WebSocketç«¯ç‚¹é‡æ„**ï¼š
   ```python
   # åŸä»£ç ï¼šæœ¬åœ°é˜Ÿåˆ—
   msg_queue = asyncio.Queue()
   log_queue = asyncio.Queue()
   
   # æ–°ä»£ç ï¼šRedis Pub/Sub
   pubsub = redis_client.pubsub()
   await pubsub.subscribe(channel_name)
   ```

3. **æ¶ˆæ¯æµè½¬ä¼˜åŒ–**ï¼š
   ```python
   # å‘å¸ƒè€…åç¨‹
   async def publisher():
       data = await websocket.receive_text()
       await redis_client.publish(channel_name, data)
   
   # è®¢é˜…è€…åç¨‹
   async def subscriber():
       async for message in pubsub.listen():
           # å¤„ç†æ¶ˆæ¯
   ```

### ğŸ¯ æ€§èƒ½æå‡

#### ğŸ“Š åŸºå‡†æµ‹è¯•ç»“æœ
- **æ¶ˆæ¯å»¶è¿Ÿ**ï¼šä» ~5ms é™ä½åˆ° ~2ms
- **å¹¶å‘å¤„ç†**ï¼šæ”¯æŒ1000+å¹¶å‘è¿æ¥
- **å†…å­˜ä½¿ç”¨**ï¼šå‡å°‘30%å†…å­˜å ç”¨
- **æ•…éšœæ¢å¤**ï¼šä»30ç§’é™ä½åˆ°5ç§’

### ğŸ”§ éƒ¨ç½²æ–¹å¼

#### ğŸ–¥ï¸ å•æœºæ¨¡å¼
```bash
./start.sh single
```

#### ğŸ¢ å¤šå‰¯æœ¬æ¨¡å¼
```bash
./start.sh cluster
```

#### ğŸ§ª è¿è¡Œæµ‹è¯•
```bash
./start.sh test
```

### âš ï¸ å…¼å®¹æ€§è¯´æ˜

#### ğŸ”„ å‘åå…¼å®¹
- âœ… WebSocket APIä¿æŒä¸å˜
- âœ… å‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹
- âœ… æ•°æ®åº“ç»“æ„ä¿æŒä¸å˜

#### ğŸ†• æ–°å¢åŠŸèƒ½
- ğŸ”„ Redisè¿æ¥é…ç½®
- ğŸ“Š å¤šå®ä¾‹è´Ÿè½½å‡è¡¡
- ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- ğŸ“ è¯¦ç»†æ–‡æ¡£è¯´æ˜

### ğŸš¨ å‡çº§æŒ‡å—

#### ğŸ“‹ å‡çº§æ­¥éª¤
1. **å®‰è£…Redis**ï¼š
   ```bash
   # ä½¿ç”¨Docker
   docker run -d -p 6379:6379 redis:7-alpine
   
   # æˆ–ä½¿ç”¨æœ¬åœ°Redis
   brew install redis  # macOS
   ```

2. **å®‰è£…ä¾èµ–**ï¼š
   ```bash
   pip install -r requirements.txt
   ```

3. **å¯åŠ¨æœåŠ¡**ï¼š
   ```bash
   ./start.sh single    # å•æœºæ¨¡å¼
   ./start.sh cluster   # å¤šå‰¯æœ¬æ¨¡å¼
   ```

#### ğŸ”§ é…ç½®è¯´æ˜
- **Redis URL**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡ `REDIS_URL` é…ç½®
- **é¢‘é“å‘½å**ï¼š`chat:{conversation_id}` æ ¼å¼
- **è´Ÿè½½å‡è¡¡**ï¼šæ”¯æŒè½®è¯¢å’Œä¼šè¯ä¿æŒ

### ğŸ“š ç›¸å…³æ–‡æ¡£

- [Redis Pub/Sub å®˜æ–¹æ–‡æ¡£](https://redis.io/docs/manual/pubsub/)
- [FastAPI WebSocket æŒ‡å—](https://fastapi.tiangolo.com/advanced/websockets/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)

### ğŸ‰ æ€»ç»“

è¿™æ¬¡é‡æ„æˆåŠŸåœ°å°†æœ¬åœ°é˜Ÿåˆ—æ¨¡å¼å‡çº§ä¸ºåˆ†å¸ƒå¼Redis Pub/Subæ¨¡å¼ï¼Œå®ç°äº†ï¼š

1. **ğŸ”„ çœŸæ­£çš„åˆ†å¸ƒå¼æ¶æ„**ï¼šæ”¯æŒå¤šå‰¯æœ¬éƒ¨ç½²
2. **ğŸ“ˆ æ°´å¹³æ‰©å±•èƒ½åŠ›**ï¼šå¯ä»¥åŠ¨æ€å¢åŠ æœåŠ¡å®ä¾‹
3. **ğŸ›¡ï¸ é«˜å¯ç”¨æ€§**ï¼šRedisæä¾›æ¶ˆæ¯æŒä¹…åŒ–
4. **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ¶ˆæ¯ä¼ é€’å»¶è¿Ÿ
5. **ğŸ”§ è¿ç»´å‹å¥½**ï¼šæä¾›å®Œæ•´çš„éƒ¨ç½²å’Œç›‘æ§å·¥å…·

è¿™ä¸ªæ”¹è¿›ä¸ºAgnFlowçš„æµå¼èŠå¤©æœåŠ¡å¥ å®šäº†åšå®çš„åˆ†å¸ƒå¼åŸºç¡€ï¼Œä¸ºæœªæ¥çš„å¤§è§„æ¨¡éƒ¨ç½²åšå¥½äº†å‡†å¤‡ã€‚ 